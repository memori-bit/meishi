# ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã®åŸå› ã¨è§£æ±ºæ–¹æ³•

## ğŸ”´ ç¾åœ¨ç™ºç”Ÿã—ã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼

### 1. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼
```
Type error: Module '"@prisma/client"' has no exported member 'PrismaClient'.
```

### 2. Turbopackãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
```
Error: Turbopack build failed with 2 errors:
./node_modules/.prisma/client/client.ts
Missing module type
Unknown module type
```

## ğŸ” ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› 

### åŸå› 1: Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆå ´æ‰€ã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã®ä¸ä¸€è‡´

**å•é¡Œç‚¹:**
- `prisma/schema.prisma`ã§`output = "../node_modules/.prisma/client"`ã‚’æŒ‡å®š
- `@prisma/client`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯`.prisma/client/default`ã‚’å‚ç…§ã—ã‚ˆã†ã¨ã™ã‚‹
- ã—ã‹ã—ã€`.prisma/client/default.ts`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„

**æ§‹é€ :**
```
node_modules/
â”œâ”€â”€ @prisma/client/
â”‚   â”œâ”€â”€ index.d.ts â†’ export * from '.prisma/client/default'
â”‚   â””â”€â”€ default.js â†’ require('.prisma/client/default')
â””â”€â”€ .prisma/client/
    â”œâ”€â”€ client.ts â† PrismaClientãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
    â”œâ”€â”€ enums.ts
    â””â”€â”€ ... (default.tsãŒå­˜åœ¨ã—ãªã„ï¼)
```

### åŸå› 2: prisma.config.tsã¨prisma/schema.prismaã®è¨­å®šç«¶åˆ

**å•é¡Œç‚¹:**
- `prisma.config.ts`ã§`generators.client.output`ã‚’è¨­å®š
- `prisma/schema.prisma`ã§ã‚‚`generator client.output`ã‚’è¨­å®š
- ä¸¡æ–¹ã®è¨­å®šãŒç«¶åˆã—ã¦ã„ã‚‹å¯èƒ½æ€§

### åŸå› 3: Turbopackã¨Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®äº’æ›æ€§å•é¡Œ

**å•é¡Œç‚¹:**
- Next.js 16ã®TurbopackãŒ`.prisma/client/client.ts`ã‚’æ­£ã—ãèªè­˜ã§ããªã„
- TypeScriptã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºãŒå¤±æ•—ã—ã¦ã„ã‚‹

## âœ… è§£æ±ºæ–¹æ³•

### è§£æ±ºç­–1: default.tsãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆï¼ˆæ¨å¥¨ï¼‰

`@prisma/client`ãŒ`.prisma/client/default`ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã€`default.ts`ã‚’ä½œæˆã—ã¾ã™ã€‚

**Dockerfileã§å®Ÿè¡Œ:**
```dockerfile
RUN npx prisma generate
RUN echo "export * from './client'" > node_modules/.prisma/client/default.ts
```

### è§£æ±ºç­–2: Prismaã®å‡ºåŠ›å…ˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™

`prisma/schema.prisma`ã‹ã‚‰`output`ã‚’å‰Šé™¤ã—ã€Prismaã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‡ºåŠ›å…ˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**å¤‰æ›´å‰:**
```prisma
generator client {
  provider = "prisma-client"
  output   = "../node_modules/.prisma/client"
}
```

**å¤‰æ›´å¾Œ:**
```prisma
generator client {
  provider = "prisma-client"
}
```

### è§£æ±ºç­–3: Turbopackã‚’ç„¡åŠ¹åŒ–

Next.jsã®ãƒ“ãƒ«ãƒ‰æ™‚ã«Turbopackã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚

**package.json:**
```json
{
  "scripts": {
    "build": "prisma generate && NEXT_PRIVATE_SKIP_TURBO=1 next build"
  }
}
```

**Dockerfile:**
```dockerfile
ENV NEXT_PRIVATE_SKIP_TURBO=1
RUN npm run build
```

## ğŸ“‹ æ¨å¥¨ã•ã‚Œã‚‹ä¿®æ­£æ‰‹é †

1. **Dockerfileã‚’ä¿®æ­£** - `default.ts`ã‚’ä½œæˆã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ ï¼ˆæ—¢ã«å®Ÿæ–½æ¸ˆã¿ï¼‰
2. **ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š** - `NEXT_PRIVATE_SKIP_TURBO=1`ã‚’è¨­å®šï¼ˆæ—¢ã«å®Ÿæ–½æ¸ˆã¿ï¼‰
3. **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å†å®Ÿè¡Œ** - ä¿®æ­£å¾Œã®Dockerfileã§ãƒ“ãƒ«ãƒ‰

## ğŸ”§ ç¾åœ¨ã®è¨­å®šçŠ¶æ³

âœ… **å®Œäº†æ¸ˆã¿:**
- `prisma/schema.prisma`ã«`output`ãƒ‘ã‚¹ã‚’è¨­å®š
- `Dockerfile`ã«`default.ts`ä½œæˆã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ 
- `Dockerfile`ã«`NEXT_PRIVATE_SKIP_TURBO=1`ã‚’è¨­å®š
- `package.json`ã®ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ 

âš ï¸ **ç¢ºèªãŒå¿…è¦:**
- ãƒ­ãƒ¼ã‚«ãƒ«ã§Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ­£ã—ãç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹
- `default.ts`ãŒæ­£ã—ãä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ãƒ­ãƒ¼ã‚«ãƒ«ã§Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†ç”Ÿæˆ
2. `default.ts`ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å†å®Ÿè¡Œ
